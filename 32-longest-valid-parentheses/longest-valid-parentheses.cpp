class Solution {
public:
    int longestValidParentheses(string s) {
      stack<int> st;
      // å“¨å…µï¼šæœ€è¿‘ä¸€æ¬¡ä¸åˆæ³•çš„ä½ç½®
      // (1)-1 ä¸åªæ˜¯é˜²æ­¢ç©ºæ ˆï¼Œ
      // (2)å®ƒçœŸçš„è¢«ç”¨æ¥ç®—â€œç¬¬ä¸€ä¸ªåˆæ³• ()â€çš„é•¿åº¦ã€‚
      st.push(-1);  

      int ans = 0;
      int n = s.size();
      for (int i = 0; i < n; i++)
      {
        char c = s[i];
        if (c == '(')
          st.push(i);
        else
        {
           //å€¼å…¥æ ˆäº† '('çš„ idx, pop çš„ä¹Ÿæ˜¯ '('çš„ idx
           st.pop();   

           if (st.empty())
           {
             //  å½“å‰ ')'ï¼š æ²¡æœ‰ä»»ä½• '(' å¯ä»¥åŒ¹é…
             //å®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªï¼š
             //ğŸ‘‰ ä¸åˆæ³•å³æ‹¬å·
             //æ‰€ä»¥ï¼š
             //å®ƒä¸èƒ½ä½œä¸ºåˆæ³•åŒºé—´çš„å³ç«¯ç‚¹
             //å®ƒåªèƒ½ä½œä¸ºï¼š
             //ğŸ‘‰ æ–°çš„ last_invalid


             // å½“å‰ ')' æ— æ³•åŒ¹é…ï¼Œä½œä¸ºæ–°çš„ base
             st.push(i);
           }
           else
           {
              // å½“å‰åˆæ³•åŒºé—´é•¿åº¦
              // (last_invalid, i] â€”â€” å·¦å¼€å³é—­åŒºé—´
              //é•¿åº¦ = å½“å‰ä¸‹æ ‡ âˆ’ æœ€è¿‘ä¸€ä¸ªä¸åˆæ³•ä¸‹æ ‡ï¼Ÿ
              ans = max(ans, i - st.top());
           }
        }
      }

      return ans;
    }
};